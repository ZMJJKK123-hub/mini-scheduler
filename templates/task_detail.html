<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ä»»åŠ¡è¯¦æƒ…</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f0f0f0; }
        .container { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 10px; }
        .header { display: flex; justify-content: space-between; margin-bottom: 30px; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #4361ee; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .task-info { margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .task-info h2 { color: #333; margin-bottom: 15px; }
        .info-row { display: flex; margin-bottom: 10px; }
        .label { width: 120px; font-weight: bold; color: #666; }
        .value { flex: 1; }
        .status { display: inline-block; padding: 5px 15px; border-radius: 20px; color: white; font-weight: bold; }
        .status-active { background: green; }
        .status-failed { background: red; }
        .status-paused { background: gray; }
        .status-running { background: orange; }
        .executions { margin-top: 30px; }
        .executions h3 { margin-bottom: 15px; color: #333; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; font-weight: bold; }
        tr:hover { background: #f5f5f5; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ä»»åŠ¡è¯¦æƒ…</h1>
            <div>
                <button class="btn btn-secondary" onclick="window.location.href='/ui/tasks'">è¿”å›åˆ—è¡¨</button>
                <button class="btn btn-primary" onclick="location.reload()">åˆ·æ–°</button>
            </div>
        </div>

        {% if task %}
        <div class="task-info">
            <h2>{{ task.name }}</h2>
            <div class="info-row">
                <div class="label">ä»»åŠ¡ID:</div>
                <div class="value">#{{ task.id }}</div>
            </div>
            <div class="info-row">
                <div class="label">çŠ¶æ€:</div>
                <div class="value">
                    <span class="status status-{{ task.status|default('UNKNOWN')|lower }}">{{ task.status }}</span>
                </div>
            </div>
            <div class="info-row">
                <div class="label">Cronè¡¨è¾¾å¼:</div>
                <div class="value"><code>{{ task.cron }}</code></div>
            </div>
            <div class="info-row">
                <div class="label">æ‰§è¡Œå‘½ä»¤:</div>
                <div class="value"><pre style="background: #f8f9fa; padding: 10px; border-radius: 5px; overflow: auto;">{{ task.command }}</pre></div>
            </div>
            <div class="info-row">
                <div class="label">åˆ›å»ºæ—¶é—´:</div>
                <div class="value">{{ task.created_at if task.created_at else "æœªçŸ¥" }}</div>
            </div>
            <div class="info-row">
                <div class="label">æœ€åæ‰§è¡Œ:</div>
                <div class="value">{{ task.last_run_at if task.last_run_at else "ä»æœªæ‰§è¡Œ" }}</div>
            </div>
            <div class="info-row">
                <div class="label">ä¸‹æ¬¡è¿è¡Œ:</div>
                <div class="value">
                    {% if next_runs %}
                        <ul style="margin:0; padding-left: 18px;">
                        {% for t in next_runs %}
                            <li>{{ t }}</li>
                        {% endfor %}
                        </ul>
                    {% else %}
                        <span style="color: #666;">æ— æ³•è§£æCronæˆ–æ— ä¿¡æ¯</span>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="action-buttons" style="margin: 20px 0; display: flex; gap: 10px; flex-wrap: wrap;">
            <form action="/tasks/{{ task.id }}/run" method="post">
                <button type="submit" class="btn btn-primary" onclick="return confirm('ç«‹å³æ‰§è¡Œæ­¤ä»»åŠ¡ï¼Ÿ')">
                    ç«‹å³æ‰§è¡Œ
                </button>
            </form>
            <button class="btn" style="background: #4361ee; color: white;" onclick="window.location.href='/ui/tasks/{{ task.id }}/edit'">
                âœï¸ ç¼–è¾‘ä»»åŠ¡
            </button>
            <form action="/tasks/{{ task.id }}/toggle" method="post">
                <button type="submit" class="btn" style="background: {% if task.status == 'PAUSED' %}#38b000{% else %}#f8961e{% endif %}; color: white;"
                        onclick="return confirm('{% if task.status == 'PAUSED' %}æ¢å¤æ­¤ä»»åŠ¡ï¼Ÿ{% else %}æš‚åœæ­¤ä»»åŠ¡ï¼Ÿ{% endif %}')">
                    {% if task.status == 'PAUSED' %}æ¢å¤ä»»åŠ¡{% else %}æš‚åœä»»åŠ¡{% endif %}
                </button>
            </form>
            <form action="/tasks/{{ task.id }}/delete" method="post" style="margin-left: auto;">
                <button type="submit" class="btn" style="background: #ef4444; color: white;" onclick="return confirm('ç¡®å®šè¦åˆ é™¤æ­¤ä»»åŠ¡å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼Œä¼šåŒæ—¶åˆ é™¤æ‰€æœ‰æ‰§è¡Œè®°å½•ã€‚')">
                    ğŸ—‘ï¸ åˆ é™¤ä»»åŠ¡
                </button>
            </form>
        </div>

        <div class="executions">
            <h3>æ‰§è¡Œè®°å½• (å…±{{ executions|length }}æ¡)</h3>
            {% if executions and executions|length > 0 %}
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>çŠ¶æ€</th>
                        <th>å¼€å§‹æ—¶é—´</th>
                        <th>ç»“æŸæ—¶é—´</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody>
                    {% for exec in executions %}
                    <tr>
                        <td>#{{ exec.id }}</td>
                        <td>
                            {% if exec.status == 'SUCCESS' %}
                                <span style="color: green; font-weight: bold;">æˆåŠŸ</span>
                            {% elif exec.status == 'FAILED' %}
                                <span style="color: red; font-weight: bold;">å¤±è´¥</span>
                            {% elif exec.status == 'RUNNING' %}
                                <span style="color: orange; font-weight: bold;">è¿è¡Œä¸­</span>
                            {% else %}
                                <span style="color: gray; font-weight: bold;">{{ exec.status }}</span>
                            {% endif %}
                        </td>
                        <td>{{ exec.started_at if exec.started_at else "-" }}</td>
                        <td>{{ exec.finished_at if exec.finished_at else "-" }}</td>
                        <td>
                            <a href="/ui/executions/{{ exec.id }}" style="color: #4361ee; text-decoration: none;">
                                æŸ¥çœ‹è¯¦æƒ…
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p style="text-align: center; color: #666; padding: 40px;">æš‚æ— æ‰§è¡Œè®°å½•</p>
            {% endif %}
        </div>
        {% else %}
        <div style="text-align: center; padding: 60px 20px; color: #666;">
            <h2>ä»»åŠ¡ä¸å­˜åœ¨</h2>
            <p style="margin: 20px 0;">æ‰¾ä¸åˆ°æŒ‡å®šçš„ä»»åŠ¡</p>
            <button class="btn btn-secondary" onclick="window.location.href='/ui/tasks'">è¿”å›ä»»åŠ¡åˆ—è¡¨</button>
        </div>
        {% endif %}
    </div>
</body>
</html>